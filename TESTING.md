# Тестирование проекта Stellar Burgers

## Описание

Проект покрыт двумя типами тестов:
- **Unit-тесты (Jest)** - для тестирования Redux слайсов и бизнес-логики
- **E2E тесты (Cypress)** - для тестирования пользовательских сценариев

## Запуск тестов

### Jest (unit-тесты)

```bash
# Запуск всех тестов
npm test

# Запуск тестов в режиме watch
npm run test:watch

# Запуск тестов с отчетом о покрытии
npm run test:coverage
```

### Cypress (E2E тесты)

```bash
# Открыть интерактивный интерфейс Cypress
npm run cypress:open

# Запустить тесты в headless режиме
npm run cypress:run
```

**Важно:** Перед запуском Cypress тестов необходимо запустить приложение:
```bash
npm start
```

## Структура тестов

### Jest тесты

Расположены в папках `__tests__` рядом с тестируемыми файлами:

- `src/services/__tests__/store.test.ts` - тесты Redux store
- `src/services/slices/__tests__/constructorSlice.test.ts` - тесты слайса конструктора
- `src/services/slices/__tests__/ingredientsSlice.test.ts` - тесты слайса ингредиентов
- `src/services/slices/__tests__/orderSlice.test.ts` - тесты слайса заказов
- `src/services/slices/__tests__/userSlice.test.ts` - тесты слайса пользователя
- `src/services/slices/__tests__/feedSlice.test.ts` - тесты слайса ленты заказов

#### Что тестируется:

1. **Инициализация rootReducer**
   - Корректное начальное состояние всех слайсов
   - Обработка неизвестных экшенов

2. **Слайс конструктора бургера**
   - Добавление ингредиентов (булки и начинки)
   - Удаление ингредиентов
   - Изменение порядка ингредиентов
   - Очистка конструктора

3. **Слайсы с асинхронными запросами**
   - Обработка состояния pending (loading: true)
   - Обработка состояния fulfilled (данные записаны, loading: false)
   - Обработка состояния rejected (ошибка записана, loading: false)

### Cypress тесты

Расположены в `cypress/e2e/constructor.cy.ts`

#### Что тестируется:

1. **Добавление ингредиентов**
   - Добавление булки в конструктор
   - Добавление основных ингредиентов
   - Добавление соусов

2. **Модальные окна**
   - Открытие модального окна с деталями ингредиента
   - Закрытие по клику на крестик
   - Закрытие по клику на оверлей
   - Отображение корректных данных

3. **Создание заказа**
   - Сборка бургера
   - Авторизация (моковая)
   - Оформление заказа
   - Проверка номера заказа
   - Закрытие модального окна
   - Очистка конструктора после создания заказа

## Моковые данные

Моковые данные для Cypress тестов находятся в папке `cypress/fixtures/`:

- `ingredients.json` - данные ингредиентов
- `user.json` - данные пользователя
- `order.json` - данные заказа

## Покрытие кода

После запуска `npm run test:coverage` отчет о покрытии будет доступен в папке `coverage/`:

- `coverage/lcov-report/index.html` - HTML отчет (откройте в браузере)
- `coverage/lcov.info` - LCOV формат для CI/CD

### Текущее покрытие Redux слайсов:

- **constructorSlice**: 100% покрытие
- **ingredientsSlice**: ~87% покрытие
- **orderSlice**: ~80% покрытие
- **userSlice**: ~62% покрытие
- **feedSlice**: ~79% покрытие
- **store**: ~92% покрытие

## Конфигурация

### Jest

Конфигурация находится в `jest.config.js`:
- Используется `ts-jest` для поддержки TypeScript
- Среда тестирования: `jsdom`
- Настроены алиасы модулей
- Исключены файлы stories и CSS модули

### Cypress

Конфигурация находится в `cypress.config.ts`:
- Базовый URL: `http://localhost:4000`
- Таймауты: 10 секунд
- Видео и скриншоты отключены для ускорения тестов

## Troubleshooting

### Jest тесты не запускаются

Убедитесь, что установлены все зависимости:
```bash
npm install
```

### Cypress тесты падают

1. Проверьте, что приложение запущено (`npm start`)
2. Проверьте, что приложение доступно по адресу `http://localhost:4000`
3. Очистите кеш Cypress: `npx cypress cache clear`

### Ошибки TypeScript в тестах

Убедитесь, что файл `tsconfig.json` включает папки с тестами.

